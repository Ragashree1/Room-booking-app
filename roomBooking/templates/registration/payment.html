{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Payment Page</title>
	<style>
		header {
			display: flex;
			align-items: center;
			justify-content: center;
			background-color: #333;
			color: #fff;
			padding: 10px;
		}

		header img {
			height: 50px;
			margin-right: 10px;
		}

		form {
			display: flex;
			flex-direction: column;
			align-items: center;
			margin-top: 50px;
		}

		input[type="text"], input[type="tel"], input[type="number"] {
			margin: 10px 0;
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 5px;
			width: 300px;
			font-size: 16px;
		}

		input[type="submit"] {
			margin: 20px 0;
			padding: 10px 20px;
			background-color: #333;
			color: #fff;
			border: none;
			border-radius: 5px;
			font-size: 16px;
			cursor: pointer;
		}
		label, input[type="text"], input[type="tel"], input[type="checkbox"], button {
		display: block;
		margin: 10px auto;
		text-align: center;
	}

		label {
			font-weight: bold;
		}

		input[type="submit"]:hover {
			background-color: #444;
		}

		.errorMsg {
			color: red;
			font-size: 14px;
			margin: 5px 0;
		}
		.hidden {
		display: none;
		}
	
	</style>

	<script>
		function checkName() {
			var cardName = document.getElementById("card_name");
			
			if (cardName.value.match(/^[A-Z][a-zA-Z]*( [A-Z][a-zA-Z]*)*$/)) {
				document.getElementById("nameError").innerHTML = "";
			} else {
				document.getElementById("nameError").innerHTML = "Invalid Name";
			}
		}

		function checkNum() {
			var cardNum = document.getElementById("card_number");

			if (cardNum.value.match(/^[0-9]{16}$/)) {
				document.getElementById("numError").innerHTML = "";
			} else {
				document.getElementById("numError").innerHTML = "Invalid Card Number";
			}
		}

		function checkExpiry() {
			var expiryDate = document.getElementById("exp_date").value;

			if (expiryDate.match(/^(0[1-9]|1[0-2])\/[0-9]{2}$/)) {}
			//
			else {
				document.getElementById("expError").innerHTML = "Invalid date format";
				return false;
			}

			var today = new Date();
			var month = today.getMonth() + 1;
			var year = today.getFullYear() % 100;

			var [inputMonth, inputYear] = expiryDate.split('/').map(Number);

			// Check if the date is expired
			if (inputYear < year || (inputYear == year && inputMonth < month)) {
				document.getElementById("expError").innerHTML = "Card is expired";
				document.getElementById("exp_date").value = "";
			} else {
				document.getElementById("expError").innerHTML = "";
			}
		}

		function checkCVV() {
			var cvv = document.getElementById("cvv").value

			if (cvv.match(/^\d{3}$/)) {
				document.getElementById("cvvError").innerHTML="";
			} else {
				document.getElementById("cvvError").innerHTML="Invalid CVV";
			}
		}
	</script>
</head>
<body>
	<header>
		<img src="{% static 'uowLogo.png' %}" alt="University of Wollongong Logo">
		<h1>Payment</h1>
	</header>
	<form action="{% url 'success' %}" method="post">
		{% csrf_token %}
		<br>
		<div id="credit_card_fields">
			<label for="card_name">Card Name:</label>
			<input type="text" id="card_name" name="card_name" pattern="^[A-Z][a-zA-Z]*( [A-Z][a-zA-Z]*)*$" placeholder="Enter Cardholder Name:" onBlur="checkName()" required>
			<span class="errorMsg" id="nameError"></span>
			<br>
			<label for="card_number">Card Number:</label>
			<input type="text" id="card_number" name="card_number" pattern="\d{16}" placeholder="Enter card number (16 digits)" onBlur="checkNum()" required>
			<span class="errorMsg" id="numError"></span>
			<br>
			<label for="exp_date">Expiration Date (MM/YY):</label>
			<input type="text" id="exp_date" name="exp_date" pattern="(0[1-9]|1[0-2])\/[0-9]{2}" placeholder="Enter expiration date (MM/YY)" onBlur="checkExpiry()" required>
			<span class="errorMsg" id="expError"></span>
			<br>
			<label for="cvv">CVV:</label>
        	<input type="text" id="cvv" name="cvv" placeholder="CVV(3 digits)" pattern="\d{3}" onBlur="checkCVV()" required>
			<span class="errorMsg" id="cvvError"></span>
			<br>
		</div>
		<label for="amount">Amount:</label>
		<input type="number" id="amount" name="amount" min="1" placeholder="Enter amount" value="{{amount|floatformat:2}}" disabled>
		<br>

	
		<input type="hidden" id="room-name" name="room-name" value="{{room}}" required>
       
        <input type="hidden" id="date" name="date" value="{{date}}" />
		<input type="hidden" id="price" name="price" value="{{price}}"/>
		<input type="hidden" id="promocode" name="promocode" value="{{promocode}}"/>

        <input id="start-time" type="hidden" name="start-time" value="{{start_time}}" />
    
        <input id="end-time" type="hidden" name="end-time" value="{{end_time}}" />
		<input type="submit" value="Confirm Payment">
	</form>
</body>
</html>